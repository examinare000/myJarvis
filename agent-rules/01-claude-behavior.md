# 01. Claude Code動作制約

## Claude Code固有の動作ルール

このファイルはClaude Code（claude.ai/code）の動作を制御する専用ルールです。

### タスク管理ルール

- **TodoWriteの使用**: 複雑なタスクは開始前に分解
- **ステータス更新**: 開始時にin_progress、完了時にcompletedにマーク
- **一度に一つのタスク**: in_progressのtodoは1つのみ
- **プロアクティブな計画**: 実装中に発見したサブタスクはtodoとして作成

#### TodoWrite使用基準

**使用する場面:**
- 3つ以上のステップが必要な複雑なタスク
- 複数のファイルにまたがる変更
- ユーザーが複数のタスクを列挙した場合
- テスト→実装→統合のような段階的作業

**使用しない場面:**
- 単一ファイルの簡単な修正
- 1～2ステップで完了する作業
- 情報収集のみの作業

### レスポンス制約

- **簡潔性**: 4行以内での回答を基本とする
- **日本語使用**: ユーザーへの回答は必ず日本語
- **説明不要**: コード説明や作業総括は不要（ユーザーが求めない限り）
- **直接回答**: 前置きや後置きの説明は避ける

### ファイル操作制約

- **既存ファイル優先**: 新規作成より既存ファイルの編集を優先
- **Read必須**: Edit/Writeの前に必ずReadで内容確認
- **アトミック変更**: 1つのEditで1つの論理的変更のみ
- **プロアクティブ制限**: ドキュメントファイル（*.md）は明示的要求時のみ作成

### 検索・分析制約

- **Task tool使用**: オープンエンドな検索は専用エージェントを使用
- **並列実行**: 複数の独立した情報収集は同時実行
- **効率優先**: 推測でファイルを特定できる場合は直接Read使用

### Git操作制約

- **コミット前確認**: git status、git diffを並列実行して状況把握
- **atomic commit**: 1コミット = 1論理変更
- **日本語コミットメッセージ**: 「機能: 説明」形式で日本語記述
- **直接コミット禁止**: master、main、developブランチへの直接コミット禁止

```bash
# 良いコミットメッセージ例
git commit -m "認証: ユーザーログイン機能を実装"
git commit -m "修正: パスワード検証のバグを解決"
git commit -m "テスト: ユーザー認証のテストケースを追加"
git commit -m "削除: 不要なデバッグログを削除"
```

### エラーハンドリング

- **セキュリティ優先**: 認証情報やAPIキーをログ出力禁止
- **構造化エラー**: 一貫した形式でエラー情報を提供
- **回復可能性**: エラー発生時も続行可能な設計

### 品質保証動作

- **テスト必須実行**: 実装後は必ずテスト実行
- **lint/typecheck実行**: 可能な場合は静的解析ツールを実行
- **段階的確認**: 実装→テスト→統合→品質確認の順で実行

### プロアクティブ制限

**プロアクティブに実行する:**
- ファイル検索・分析
- テスト実行
- 品質チェック（lint、typecheck）
- セキュリティ検証

**プロアクティブに実行しない:**
- 新規ファイル作成（特にドキュメント）
- git commit（明示的要求時のみ）
- 設定ファイルの変更
- 外部サービスへのアクセス

### デバッグ支援

- **一時的デバッグログ**: 明確なプレフィックス使用
- **除去コミット**: デバッグログ削除は専用コミット
- **文脈情報**: 関連する状態とパラメータを含める

```python
# デバッグ追加時
print(f"[DEBUG] ユーザー認証: user_id={user_id}, email={email}")

# 削除時のコミット
git commit -m "削除: 認証機能のデバッグログを削除"
```

## 制約の継承と上書き

- **基盤原則継承**: 00-core-principles.mdの原則をすべて継承
- **矛盾時の優先**: 番号が大きいファイルの指示を優先
- **部分上書き**: 具体的な指示で基本動作を上書き可能

---

**適用優先度**: 🟠 高（Claude Code使用時は必須遵守）
**更新頻度**: Claude Codeの機能更新に合わせて随時更新