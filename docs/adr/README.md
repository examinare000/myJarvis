# Architecture Decision Records (ADR)

このディレクトリには、myJarvisプロジェクトの重要なアーキテクチャ決定が記録されています。

## ADR一覧

### [ADR-001: マルチプラットフォーム戦略](./ADR-001-マルチプラットフォーム戦略.md)
**決定**: Kotlin Multiplatform + ネイティブUI (SwiftUI/React)
**理由**: ビジネスロジックの共通化とネイティブUX体験の両立

### [ADR-002: 外部サービス統合戦略](./ADR-002-外部サービス統合戦略.md)
**決定**: BFF (Backend for Frontend) パターン
**理由**: 認証情報の安全管理と外部API変更への耐性確保

### [ADR-003: AI/MLパイプライン設計](./ADR-003-AI-MLパイプライン設計.md)
**決定**: ハイブリッド実行（LLM: クラウド, ML: ローカル）
**理由**: 高度なタスク分解能力とプライバシー保護の両立

### [ADR-004: 通知システム設計](./ADR-004-通知システム設計.md)
**決定**: ハイブリッド通知（サーバートリガー + クライアント最適化）
**理由**: 外部イベントへの即応性とパーソナライズの両立

### [ADR-005: データストレージ・プライバシー戦略](./ADR-005-データストレージ・プライバシー戦略.md)
**決定**: ハイブリッドストレージ（機密度別データ分離）
**理由**: プライバシー保護とマルチデバイス同期の両立

### [ADR-006: リアルタイム同期戦略](./ADR-006-リアルタイム同期戦略.md)
**決定**: WebSockets ベースの双方向通信
**理由**: 真のリアルタイム体験と効率的な通信の実現

## アーキテクチャ概要図

```
┌─────────────────────┐    ┌─────────────────────┐
│   iOS App (Swift)   │    │ Web App (React)     │
│                     │    │                     │
│ ┌─────────────────┐ │    │ ┌─────────────────┐ │
│ │   SwiftUI UI    │ │    │ │   React UI      │ │
│ └─────────────────┘ │    │ └─────────────────┘ │
│ ┌─────────────────┐ │    │ ┌─────────────────┐ │
│ │ KMP Shared Core │ │    │ │ KMP Shared Core │ │
│ │  - Business     │ │    │ │  - Business     │ │
│ │    Logic        │ │    │ │    Logic        │ │
│ │  - Local ML     │ │    │ │  - Local ML     │ │
│ │  - WebSocket    │ │    │ │  - WebSocket    │ │
│ └─────────────────┘ │    │ └─────────────────┘ │
└─────────────────────┘    └─────────────────────┘
           │                           │
           └───────────┬───────────────┘
                       │ WebSocket/HTTPS
                       ▼
         ┌─────────────────────────────┐
         │    Node.js BFF Server       │
         │                             │
         │ ┌─────────────────────────┐ │
         │ │  External API Gateway   │ │
         │ │  - Google Calendar      │ │
         │ │  - Gmail                │ │
         │ │  - Slack                │ │
         │ └─────────────────────────┘ │
         │ ┌─────────────────────────┐ │
         │ │  LLM Processing         │ │
         │ │  - Gemini API           │ │
         │ │  - Task Decomposition   │ │
         │ └─────────────────────────┘ │
         │ ┌─────────────────────────┐ │
         │ │  Real-time Sync         │ │
         │ │  - WebSocket Manager    │ │
         │ │  - Redis Pub/Sub        │ │
         │ └─────────────────────────┘ │
         └─────────────────────────────┘
                       │
                       ▼
         ┌─────────────────────────────┐
         │     Data Storage            │
         │                             │
         │ ┌─────────────────────────┐ │
         │ │  Encrypted Database     │ │
         │ │  (Non-sensitive data)   │ │
         │ └─────────────────────────┘ │
         │                             │
         │ ┌─────────────────────────┐ │
         │ │  Local Device Storage   │ │
         │ │  (Sensitive data only)  │ │
         │ └─────────────────────────┘ │
         └─────────────────────────────┘
```

## 重要な設計原則

### 1. プライバシーファースト
機微な個人情報（バイタル、満足度等）はデバイス内にのみ保存し、クラウドには送信しません。

### 2. ハイブリッドアプローチ
各コンポーネント（UI、AI/ML、同期、ストレージ）で最適な技術選択を行い、トレードオフを適切にバランスします。

### 3. スケーラブルアーキテクチャ
初期実装はシンプルに保ちつつ、将来の拡張に備えた設計を採用しています。

### 4. セキュリティバイデザイン
全ての決定において、セキュリティとプライバシーを最優先事項として考慮しています。

## 次のステップ

1. **プロトタイプ開発**: ADR-001のKotlin Multiplatform環境構築
2. **セキュリティ監査**: ADR-005のデータ分類とプライバシー対策の詳細設計
3. **パフォーマンステスト**: ADR-006のWebSocket実装の負荷テスト
4. **ユーザビリティテスト**: ADR-004の通知システムのUXテスト

各ADRの実装状況と変更履歴は、個別のADRファイル内で管理されます。