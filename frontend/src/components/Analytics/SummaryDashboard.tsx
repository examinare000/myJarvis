import React, { useState, useEffect } from 'react';\nimport {\n  Box,\n  Paper,\n  Typography,\n  Grid,\n  Card,\n  CardContent,\n  CircularProgress,\n  Alert,\n  LinearProgress,\n  Avatar,\n  Chip,\n} from '@mui/material';\nimport {\n  TrendingUp as TrendingUpIcon,\n  Assignment as TaskIcon,\n  Event as EventIcon,\n  Mood as MoodIcon,\n  Timeline as TimelineIcon,\n} from '@mui/icons-material';\nimport analyticsService, { SummaryAnalytics } from '../../services/analyticsService';\n\nconst SummaryDashboard: React.FC = () => {\n  const [analytics, setAnalytics] = useState<SummaryAnalytics | null>(null);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    fetchAnalytics();\n  }, []);\n\n  const fetchAnalytics = async () => {\n    setLoading(true);\n    setError(null);\n    try {\n      const data = await analyticsService.getSummaryAnalytics();\n      setAnalytics(data);\n    } catch (error) {\n      setError('ã‚µãƒãƒªãƒ¼ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');\n      console.error('Summary analytics fetch error:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const getMoodEmoji = (mood: string): string => {\n    const moodMap: Record<string, string> = {\n      'happy': 'ğŸ˜Š',\n      'excited': 'ğŸ¤©',\n      'content': 'ğŸ˜Œ',\n      'neutral': 'ğŸ˜',\n      'tired': 'ğŸ˜´',\n      'stressed': 'ğŸ˜°',\n      'sad': 'ğŸ˜¢',\n      'angry': 'ğŸ˜ ',\n      'anxious': 'ğŸ˜Ÿ',\n      'focused': 'ğŸ¯',\n      'creative': 'ğŸ¨',\n      'grateful': 'ğŸ™',\n    };\n    return moodMap[mood.toLowerCase()] || 'ğŸ˜';\n  };\n\n  const getCompletionRateColor = (rate: number): 'error' | 'warning' | 'success' => {\n    if (rate < 50) return 'error';\n    if (rate < 80) return 'warning';\n    return 'success';\n  };\n\n  if (loading) {\n    return (\n      <Box sx={{ display: 'flex', justifyContent: 'center', alignItems: 'center', minHeight: '400px' }}>\n        <CircularProgress />\n      </Box>\n    );\n  }\n\n  if (error) {\n    return (\n      <Alert severity=\"error\" sx={{ mt: 2 }}>\n        {error}\n      </Alert>\n    );\n  }\n\n  if (!analytics) {\n    return (\n      <Alert severity=\"info\" sx={{ mt: 2 }}>\n        ã‚µãƒãƒªãƒ¼ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“\n      </Alert>\n    );\n  }\n\n  const { summary } = analytics;\n  const maxActivityValue = Math.max(...summary.activityTrend.map(a => a.total));\n\n  return (\n    <Box>\n      <Typography variant=\"h4\" component=\"h1\" gutterBottom>\n        ğŸ“ˆ é€±é–“ã‚µãƒãƒªãƒ¼\n      </Typography>\n      \n      <Typography variant=\"subtitle1\" color=\"text.secondary\" sx={{ mb: 3 }}>\n        éå»7æ—¥é–“ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£æ¦‚è¦\n      </Typography>\n\n      {/* Key Metrics Cards */}\n      <Grid container spacing={3} sx={{ mb: 4 }}>\n        <Grid item xs={12} sm={6} md={3}>\n          <Card sx={{ height: '100%' }}>\n            <CardContent>\n              <Box sx={{ display: 'flex', alignItems: 'center', gap: 2, mb: 2 }}>\n                <TaskIcon color=\"primary\" sx={{ fontSize: 40 }} />\n                <Box>\n                  <Typography variant=\"h4\">{summary.tasks.total}</Typography>\n                  <Typography variant=\"body2\" color=\"text.secondary\">\n                    ç·ã‚¿ã‚¹ã‚¯æ•°\n                  </Typography>\n                </Box>\n              </Box>\n              <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>\n                <Typography variant=\"body2\">å®Œäº†ç‡:</Typography>\n                <Chip\n                  label={`${summary.tasks.completionRate}%`}\n                  color={getCompletionRateColor(summary.tasks.completionRate)}\n                  size=\"small\"\n                />\n              </Box>\n              <LinearProgress\n                variant=\"determinate\"\n                value={summary.tasks.completionRate}\n                color={getCompletionRateColor(summary.tasks.completionRate)}\n                sx={{ mt: 1, height: 6, borderRadius: 3 }}\n              />\n            </CardContent>\n          </Card>\n        </Grid>\n\n        <Grid item xs={12} sm={6} md={3}>\n          <Card sx={{ height: '100%' }}>\n            <CardContent>\n              <Box sx={{ display: 'flex', alignItems: 'center', gap: 2, mb: 2 }}>\n                <MoodIcon color=\"secondary\" sx={{ fontSize: 40 }} />\n                <Box>\n                  <Typography variant=\"h4\">{summary.mood.entries}</Typography>\n                  <Typography variant=\"body2\" color=\"text.secondary\">\n                    ãƒ©ã‚¤ãƒ•ãƒ­ã‚°è¨˜éŒ²\n                  </Typography>\n                </Box>\n              </Box>\n              <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>\n                <Typography variant=\"body2\">ä¸»è¦ãƒ ãƒ¼ãƒ‰:</Typography>\n                <Chip\n                  label={`${getMoodEmoji(summary.mood.dominant)} ${summary.mood.dominant}`}\n                  size=\"small\"\n                  sx={{ bgcolor: 'secondary.light', color: 'secondary.contrastText' }}\n                />\n              </Box>\n            </CardContent>\n          </Card>\n        </Grid>\n\n        <Grid item xs={12} sm={6} md={3}>\n          <Card sx={{ height: '100%' }}>\n            <CardContent>\n              <Box sx={{ display: 'flex', alignItems: 'center', gap: 2, mb: 2 }}>\n                <EventIcon color=\"info\" sx={{ fontSize: 40 }} />\n                <Box>\n                  <Typography variant=\"h4\">{summary.events.total}</Typography>\n                  <Typography variant=\"body2\" color=\"text.secondary\">\n                    ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆ\n                  </Typography>\n                </Box>\n              </Box>\n              <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>\n                <Typography variant=\"body2\">äºˆå®š:</Typography>\n                <Chip\n                  label={`${summary.events.upcoming} upcoming`}\n                  color=\"info\"\n                  size=\"small\"\n                />\n              </Box>\n            </CardContent>\n          </Card>\n        </Grid>\n\n        <Grid item xs={12} sm={6} md={3}>\n          <Card sx={{ height: '100%' }}>\n            <CardContent sx={{ textAlign: 'center' }}>\n              <TrendingUpIcon sx={{ fontSize: 60, color: 'success.main', mb: 1 }} />\n              <Typography variant=\"h5\" color=\"success.main\" sx={{ fontWeight: 'bold' }}>\n                æ´»ç™º\n              </Typography>\n              <Typography variant=\"body2\" color=\"text.secondary\">\n                ä»Šé€±ã®æ´»å‹•ãƒ¬ãƒ™ãƒ«\n              </Typography>\n            </CardContent>\n          </Card>\n        </Grid>\n      </Grid>\n\n      {/* Activity Trend */}\n      <Grid container spacing={3}>\n        <Grid item xs={12} lg={8}>\n          <Paper sx={{ p: 3 }}>\n            <Box sx={{ display: 'flex', alignItems: 'center', gap: 2, mb: 3 }}>\n              <TimelineIcon color=\"primary\" />\n              <Typography variant=\"h6\">é€±é–“ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ãƒˆãƒ¬ãƒ³ãƒ‰</Typography>\n            </Box>\n            \n            <Box sx={{ display: 'flex', flexDirection: 'column', gap: 2 }}>\n              {summary.activityTrend.map((day, index) => (\n                <Box key={index}>\n                  <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 1 }}>\n                    <Typography variant=\"body2\" sx={{ fontWeight: 'bold', minWidth: 80 }}>\n                      {new Date(day.date).getMonth() + 1}/{new Date(day.date).getDate()}\n                    </Typography>\n                    <Typography variant=\"caption\" color=\"text.secondary\">\n                      åˆè¨ˆ: {day.total}\n                    </Typography>\n                  </Box>\n                  \n                  <Box sx={{ position: 'relative' }}>\n                    <LinearProgress\n                      variant=\"determinate\"\n                      value={day.total > 0 ? (day.total / maxActivityValue) * 100 : 0}\n                      sx={{\n                        height: 24,\n                        borderRadius: 2,\n                        backgroundColor: 'grey.200',\n                        '& .MuiLinearProgress-bar': {\n                          backgroundColor: 'primary.main',\n                          borderRadius: 2,\n                        },\n                      }}\n                    />\n                    <Box sx={{\n                      position: 'absolute',\n                      top: 0,\n                      left: 0,\n                      right: 0,\n                      bottom: 0,\n                      display: 'flex',\n                      alignItems: 'center',\n                      paddingX: 1,\n                      gap: 1,\n                    }}>\n                      {day.tasks > 0 && (\n                        <Chip label={`T:${day.tasks}`} size=\"small\" sx={{ height: 16, fontSize: '0.6rem' }} />\n                      )}\n                      {day.lifelogs > 0 && (\n                        <Chip label={`L:${day.lifelogs}`} size=\"small\" color=\"secondary\" sx={{ height: 16, fontSize: '0.6rem' }} />\n                      )}\n                      {day.events > 0 && (\n                        <Chip label={`E:${day.events}`} size=\"small\" color=\"info\" sx={{ height: 16, fontSize: '0.6rem' }} />\n                      )}\n                    </Box>\n                  </Box>\n                </Box>\n              ))}\n            </Box>\n          </Paper>\n        </Grid>\n\n        {/* Quick Stats */}\n        <Grid item xs={12} lg={4}>\n          <Paper sx={{ p: 3, height: '100%' }}>\n            <Typography variant=\"h6\" gutterBottom>ä»Šé€±ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆ</Typography>\n            \n            <Box sx={{ display: 'flex', flexDirection: 'column', gap: 3 }}>\n              <Box>\n                <Typography variant=\"body2\" color=\"text.secondary\" gutterBottom>\n                  ğŸ¯ ç”Ÿç”£æ€§ã‚¹ã‚³ã‚¢\n                </Typography>\n                <Box sx={{ display: 'flex', alignItems: 'center', gap: 2 }}>\n                  <CircularProgress\n                    variant=\"determinate\"\n                    value={summary.tasks.completionRate}\n                    size={60}\n                    color={getCompletionRateColor(summary.tasks.completionRate)}\n                  />\n                  <Typography variant=\"h4\" color={`${getCompletionRateColor(summary.tasks.completionRate)}.main`}>\n                    {summary.tasks.completionRate}%\n                  </Typography>\n                </Box>\n              </Box>\n\n              <Box>\n                <Typography variant=\"body2\" color=\"text.secondary\" gutterBottom>\n                  ğŸ“ è¨˜éŒ²ç¿’æ…£\n                </Typography>\n                <Typography variant=\"h6\">\n                  {summary.mood.entries > 0 ? 'è‰¯å¥½' : 'æ”¹å–„ã®ä½™åœ°ã‚ã‚Š'}\n                </Typography>\n                <Typography variant=\"caption\" color=\"text.secondary\">\n                  {summary.mood.entries}ä»¶ã®ãƒ©ã‚¤ãƒ•ãƒ­ã‚°è¨˜éŒ²\n                </Typography>\n              </Box>\n\n              <Box>\n                <Typography variant=\"body2\" color=\"text.secondary\" gutterBottom>\n                  ğŸ“… ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç®¡ç†\n                </Typography>\n                <Typography variant=\"h6\">\n                  {summary.events.total > 0 ? 'ã‚¢ã‚¯ãƒ†ã‚£ãƒ–' : 'è¨ˆç”»ã‚’ç«‹ã¦ã¾ã—ã‚‡ã†'}\n                </Typography>\n                <Typography variant=\"caption\" color=\"text.secondary\">\n                  {summary.events.upcoming}ä»¶ã®äºˆå®š\n                </Typography>\n              </Box>\n            </Box>\n          </Paper>\n        </Grid>\n      </Grid>\n    </Box>\n  );\n};\n\nexport default SummaryDashboard;